<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Apr 24 12:31:15 2018 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>plans.pro (Documentation for /Users/penton/Dropbox/LASP/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="plans.pro (Documentation for /Users/penton/Dropbox/LASP/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>

<span class="comments">;+</span>
<span class="comments">;	NAME: PLANS</span>
<span class="comments">;</span>
<span class="comments">;	PURPOSE: Sandbox to test analysis code and results</span>
<span class="comments">;</span>
<span class="comments">;***** Background:</span>
<span class="comments">;This data is similar to what the SORCE SOLSTICE instrument has available (though</span>
<span class="comments">;it is a small subset of the wavelength range). This specific data set is a</span>
<span class="comments">;simulation around the Si 2 emission lines (~180nm).</span>
<span class="comments">;</span>
<span class="comments">;SOLSTICE collects data by looking at the sun. Light enters the aperture, follows</span>
<span class="comments">;the optical path which includes a grating, then lands on a photomultiplier tube</span>
<span class="comments">;(pmt) which counts the number of photon events. The position of the grating can</span>
<span class="comments">;be changed, which changes the wavelength of light hitting the pmt, which allows</span>
<span class="comments">;for the measurement of the solar spectrum.</span>
<span class="comments">;</span>
<span class="comments">;The SORCE spacecraft is in an orbit with roughly a ninety minute period.</span>
<span class="comments">;Unfortunately the spacecraft batteries are going bad. It cannot maintain the</span>
<span class="comments">;power required to keep the instrument at it's ideal temperature (22 deg C) and</span>
<span class="comments">;so the heaters are turned off during eclipse. This has created significant</span>
<span class="comments">;temperature swings. Another unfortunate side effect is that the grating position</span>
<span class="comments">;is reset with each orbit and it never returns to the exact fiducial. This</span>
<span class="comments">;creates a small grating offset from orbit to orbit which effects the actual</span>
<span class="comments">;grating position from what is being reported.</span>
<span class="comments">;</span>
<span class="comments">;From orbit to orbit, the spacecraft will execute different experiments, to</span>
<span class="comments">;measure different effects. The included data covers about five orbits worth of</span>
<span class="comments">;data, with different experiments on each orbit.</span>
<span class="comments">;</span>
<span class="comments">;Over this time period, it is reasonable to assume the solar variability for this</span>
<span class="comments">;wavelength range is not measureable by this detector.</span>
<span class="comments">;</span>
<span class="comments">;***** Task: Please calculate the irradiance in watts/m^2 and compare the scan</span>
<span class="comments">;data. Provide plots of your results along with your code. Specifically, plot the</span>
<span class="comments">;region around the two emission lines at ~180nm. Also, calculate the ratio of</span>
<span class="comments">;each scan wrt the reference spectrum and plot the results. What are your</span>
<span class="comments">;thoughts? Use any language you are comfortable with.</span>
<span class="comments">;</span>
<span class="comments">; From plans.txt: planName, startTime, endTime</span>
<span class="comments">;</span>
<span class="comments">; Orbit 1 =	QuickScan, 9.434017775100002E14, 9.434062192200002E14</span>
<span class="comments">; Orbit 2 =	ConstantWavelength, 9.434076142300002E14, 9.434120464800002E14</span>
<span class="comments">; Orbit 3 =	DownScan, 9.434134508500002E14, 9.434178736700002E14</span>
<span class="comments">; Orbit 4 =	Dark, 9.434192873600002E14, 9.434237008000002E14</span>
<span class="comments">; Orbit 5 =	UpScan, 9.434251237500002E14, 9.434295278700002E14</span>
<span class="comments">;</span>
<span class="comments">; 1) Why is there a "down spectrum" during the CW portion ?</span>
<span class="comments">;	Blake reports this scan is fine to use</span>
<span class="comments">;</span>
<span class="comments">;***** Equations</span>
<span class="comments">;</span>
<span class="comments">; * Wavelength (the grating equation) :</span>
<span class="comments">;    offset = 239532.38</span>
<span class="comments">;    stepSize = 2.4237772022101214E-6 [rad]</span>
<span class="comments">;    d = 277.77777777777777 [nm]</span>
<span class="comments">;    phiGInRads = 0.08503244115716374 [rad]</span>
<span class="comments">;    ang1 = (offset - gratingPosition) * stepSize</span>
<span class="comments">;    wavelength = 2 * d * sin(ang1) * cos(phiGInRads / 2.0) [nm]</span>
<span class="comments">;</span>
<span class="comments">; * counts/second/area :</span>
<span class="comments">;    integrationTime -> convert to seconds from ms</span>
<span class="comments">;    cr = counts / integrationTime [counts / sec / nm] (the per nm is from the sampling at the specific grating position)</span>
<span class="comments">;    apArea = .01 [cm^2] (aperture area)</span>
<span class="comments">;    photonspersecPerCm2 = cr / apArea [photons/sec/cm^2/nm]</span>
<span class="comments">;</span>
<span class="comments">; * watts/meter^2</span>
<span class="comments">;    wavelengthInMeters -> convert to meters from nm</span>
<span class="comments">;    h = 6.62606957E-34 [J*s]</span>
<span class="comments">;    c = 299792458.0 [m/s]</span>
<span class="comments">;    energyPerPhoton = h * c / wavelengthInMeters [J]</span>
<span class="comments">;    wattsPerM2 = photonspersecPerArea * 1e2 * 1e2 * energyPerPhoton [watts/m^2/nm]</span>
<span class="comments">;</span>
<span class="comments">;***** Files</span>
<span class="comments">;All files are comma separated with a one line header.</span>
<span class="comments">;</span>
<span class="comments">;  * detectorTemp.txt : in degrees Celsius. It is roughly sampled at 1 second.</span>
<span class="comments">;  * distanceAndDoppler.txt : These are the corrections used to adjust for the changing</span>
<span class="comments">;    distance and velocity of the spacecraft relative to the sun.</span>
<span class="comments">;  * instrumentTelemetry.txt : Includes grating position and measured detector counts. It is sampled</span>
<span class="comments">;    proportional to the current integration time. (keep in mind that this is measured counts which</span>
<span class="comments">;    which could be dependent on other variables)</span>
<span class="comments">;  * integrationTime.txt : This is the current set integration time (ms) of the instrument.</span>
<span class="comments">;    Assume the value is constant until there is a new value.</span>
<span class="comments">;  * plans.txt : This file includes the experiment names with start/end times. You can find the</span>
<span class="comments">;    time ranges of the plans of interest her. [start, end)</span>
<span class="comments">;  * referenceSpectrum.txt : This is a reference spectrum with accurate wavelengths. The current</span>
<span class="comments">;    irradiance measurements will be within 15% of this spectrum.</span>
<span class="comments">;</span>
<span class="comments">; w = 182nm = 1.85E-7m</span>
<span class="comments">;</span>
<span class="comments">; Plan:</span>
<span class="comments">;  Read in the intrumentTelementry for a given time range and return the graPos & counts</span>



<a id="plans:source"></a>pro plans,plot_counts=plot_counts,plot_gratpos=plot_gratpos,plot_waves=plot_waves,plot_irr,$
	op=op,verbose=verbose,plot_temps=plot_temps,make_final=make_final,plot_all=plot_all
	if n_elements(plot_all) ne 1 then plot_all=0
	if n_elements(make_final) ne 1 then make_final=1
	if n_elements(verbose) ne 1 then verbose=0
	if n_elements(op) ne 1 then op=1
	if n_elements(plot_counts) ne 1 then plot_counts=0
	if n_elements(plot_gratpos) ne 1 then plot_gratpos=0
	if n_elements(plot_waves) ne 1 then plot_waves=0
	if n_elements(plot_irr) ne 1 then plot_irr=1
	if n_elements(plot_temps) ne 1 then plot_temps=0

	pngdir=get_laspdir(/png)
	up_color=get_up_color()
	dn_color=get_dn_color()
	rf_color=get_ref_color()
	<span class="comments">;planName, startTime, endTime</span>
	names=['QuickScan','ConstantWavelength','DownScan','Dark','UpScan']
	QuickScan=[9.434017775100002E14, 9.434062192200002E14]
	ConstantWavelength=[9.434076142300002E14, 9.434120464800002E14] <span class="comments">; 9.4340988e+14</span>
	DownScan=[9.434134508500002E14, 9.434178736700002E14]
	Dark=[9.434192873600002E14, 9.434237008000002E14]
	UpScan=[9.434251237500002E14, 9.434295278700002E14]
	<span class="comments">;</span>
	<span class="comments">; For each plan, get the basic telemetry</span>
	<span class="comments">;</span>
	message,/info,'************ '+names[0]
	QS_telem=get_telem(QuickScan)
	message,/info,'************ '+names[1]
	CW_telem=get_telem(ConstantWavelength)
	message,/info,'************ '+names[2]
	DS_telem=get_telem(DownScan)
	message,/info,'************ '+names[3]
	DK_telem=get_telem(Dark,/dark)
	message,/info,'************ '+names[4]
	US_telem=get_telem(UpScan)
	<span class="comments">;</span>
	<span class="comments">; plot them to see what we have</span>
	<span class="comments">;</span>
	close_gwin
	if plot_counts or plot_all then begin
		pQS=plot(QS_telem.times_s,QS_telem.counts,xtitle='Time (s)',ytitle='Counts',name='Quick Scan',font_size=12,font_name='Times')
		pCW=plot(CW_telem.times_s,CW_telem.counts,xtitle='Time (s)',ytitle='Counts',name='Constant Wavelength',/overplot)
		pDS=plot(DS_telem.times_s,DS_telem.counts,xtitle='Times (s)',ytitle='Counts',name='Down Scan',/overplot,color=dn_color)
		pDK=plot(DK_telem.times_s,DK_telem.counts,xtitle='Times (s)',ytitle='Counts',name='Dark',/overplot)
		pUS=plot(US_telem.times_s,US_telem.counts,xtitle='Times (s)',ytitle='Counts',name='Up Scan',/overplot,color=up_color)
		l=legend(/auto_text_color,shadow=0,linestyle=6,font_name='Times')
		pQS.save,pngdir+'plot_counts.png'
	endif
	if plot_gratpos or plot_all then begin
		gQS=plot(QS_telem.times_s,QS_telem.ggratpos,xtitle='Times (s)',ytitle='Grating Position',name='Quick Scan',font_size=12,font_name='Times')
		gCW=plot(CW_telem.times_s,CW_telem.ggratpos,xtitle='Times (s)',ytitle='Grating Position',name='Constant Wavelength',/overplot)
		gDS=plot(DS_telem.times_s,DS_telem.ggratpos,xtitle='Times (s)',ytitle='Grating Position',name='Down Scan',/overplot,color=dn_color)
		<span class="comments">;gDK=plot(DK_telem.times_s,DK_telem.ggratpos,xtitle='Times (s)',ytitle='Grating Position',name='Dark',/overplot)</span>
		gUS=plot(US_telem.times_s,US_telem.ggratpos,xtitle='Times (s)',ytitle='Grating Position',name='Up Scan',/overplot,color=up_color)
		l=legend(/auto_text_color,shadow=0,linestyle=6,font_name='Times')
		gQS.save,pngdir+'plot_gratpos.png'
	endif

	refspec=get_refspec(/do_plot)

	if plot_waves or plot_all then begin
		wQS=plot(QS_telem.waves,QS_telem.counts,xtitle='Wavelength (nm)',ytitle='Counts',name='Quick Scan',font_size=12,font_name='Times',$
			xrange=[174,190],color='HOT PINK')
		wCW=plot(CW_telem.waves,CW_telem.counts,xtitle='Wavelength (nm)',ytitle='Counts',name='Constant Wavelength',/overplot,color='RED')
		wDS=plot(DS_telem.waves,DS_telem.counts,xtitle='Wavelength (nm)',ytitle='Counts',name='Down Scan',/overplot,color=up_color)
		<span class="comments">;wDK=plot(DK_telem.waves,DK_telem.counts,xtitle='Wavelength (nm)',ytitle='Counts',name='Dark',/overplot,color='BLACK')</span>
		wUS=plot(US_telem.waves,US_telem.counts,xtitle='Wavelength (nm)',ytitle='Counts',name='Up Scan',/overplot,color=dn_color)
		l=legend(/auto_text_color,shadow=0,linestyle=6,font_name='Times')
		wQS.save,pngdir+'plot_waves.png'
	endif
	if plot_temps or plot_all then begin
		tQS=plot(QS_telem.times_s,QS_telem.Temps,xtitle='Time (s)',ytitle='Temp',name='Quick Scan',font_size=12,font_name='Times',$
			xrange=[174,190],color='HOT PINK')
		tCW=plot(CW_telem.times_s,CW_telem.Temps,xtitle='Time (s)',ytitle='Temp',name='Constant Wavelength',/overplot,color='RED')
		tDS=plot(DS_telem.times_s,DS_telem.Temps,xtitle='Time (s)',ytitle='Temp',name='Down Scan',/overplot,color=dn_color)
		tDK=plot(DK_telem.times_s,DK_telem.Temps,xtitle='Time (s)',ytitle='Temp',name='Dark',/overplot,color='BLACK')
		tUS=plot(US_telem.times_s,US_telem.Temps,xtitle='Time (s)',ytitle='Temp',name='Up Scan',/overplot,color=up_color)
		l=legend(/auto_text_color,shadow=0,linestyle=6,font_name='Times')
		tQS.save,pngdir+'plot_temps.png'
	endif
	<span class="comments">;</span>
	<span class="comments">; Convert counts to irradiance</span>
	<span class="comments">;</span>
	if plot_irr or plot_all then begin
		wQS=plot(QS_telem.waves,QS_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Quick Scan',font_size=12,font_name='Times',$
			xrange=[174,190],color='HOT PINK')
		wQS.title='Orbit 1 : QuickScan'
		wDS=plot(DS_telem.waves,DS_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Down Scan',overplot=op,color=dn_color)
		<span class="comments">;wDK=plot(DK_telem.waves,DK_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Dark',overplot=op,color='BLACK')</span>
		wUS=plot(US_telem.waves,US_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Up Scan',overplot=op,color=up_color)
		l=legend(/auto_text_color,shadow=0,linestyle=6,font_name='Times')
			wQS.save,pngdir+'wQS.png'
		wb=get_waveband()
		wQS.xrange=wb
		wQS.save,pngdir+'wQS_zoom.png'
		wCW=plot(CW_telem.waves,CW_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Constant Wavelength',title='Constant Wavelength',color='RED')
		wCW.title='Orbit 2 : Constant Wavelength'
		wCW.save,pngdir+'wCW.png'
		wCW.xrange=wb
		wCW.save,pngdir+'wCW_zoom.png'

		wDS=plot(DS_telem.waves,DS_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Constant Wavelength',title='Constant Wavelength',color='RED')
		wDS.title='Orbit 3 : Down Scan'
		wDS.save,pngdir+'wDS.png'
		wDS.xrange=wb
		wDS.save,pngdir+'wDS_zoom.png'

		<span class="comments">;wDK=plot(DK_telem.waves,DK_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Constant Wavelength',title='Constant Wavelength',color='RED')</span>
		<span class="comments">;w.DK.title='Orbit 4 : Dark'</span>
		<span class="comments">;wDK.save,pngdir+'wDK.png'</span>
		<span class="comments">;wDK.xrange=wb</span>
		<span class="comments">;wDK.save,pngdir+'wDK_zoom.png'</span>

		wUS=plot(US_telem.waves,US_telem.irr,xtitle='Wavelength (nm)',ytitle='Irradiance',name='Constant Wavelength',title='Constant Wavelength',color='RED')
		wUS.title='Orbit 5 : UpScan'
		wUS.save,pngdir+'wUS.png'
		wUS.xrange=wb
		wUS.save,pngdir+'wUS_zoom.png'

		wUPD=plot(DS_telem.waves,US_telem.irr-DS_telem.irr,xtitle='Wavelength (nm)',ytitle='$\Delta$ Irradiance',name='Up-Down',color='DARK BLUE')
		wUPD.save,pngdir+'wUPD.png'
		wUPD.xrange=wb
		wUPD.save,pngdir+'wUPD_zoom.png'

		wUPR=plot(DS_telem.waves,US_telem.irr-DS_telem.irr,xtitle='Wavelength (nm)',ytitle='$\Delta$ Irradiance',name='Reference-Up',color='DARK BLUE')
		wDNR=plot(DS_telem.waves,US_telem.irr-DS_telem.irr,name='Reference-Down',color=dn_color,/overplot)
		wUPR.save,pngdir+'wUPR.png'
		wUPR.xrange=wb
		wUPR.save,pngdir+'wUPR_zoom.png'
	endif

	if make_final or plot_all then begin
		wRF=plot(nm,irr,xtitle='Wavelength (nm)',ytitle='Irradiance',font_name='Times',font_size=14,color=rf_color,name='Reference Spectrum')
		wDS=plot(DS_telem.waves,DS_telem.irr,name='Down Scan',color=up_color,/overplot)
		wUS=plot(US_telem.waves,US_telem.irr,name='Up Scan',color=dn_color,/overplot)
		wRF.save,pngdir+'make_final.png'
	endif
	if debug then stop
end
</code>
    </div>
  </body>
</html>